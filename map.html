<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live GPS Tracker</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3reJ1SJkqXTr1Zriadsu6bchWADNfaZs"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:
    linear-gradient(rgba(0,90,40,.6),rgba(0,90,40,.8)),
    url(https://images.unsplash.com/photo-1501004318641-b39e6451bec6);
  background-size:cover;
  color:#fff;
  padding:14px;
}

.container{width:100%;max-width:900px;}

.card{
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(10px);
  border-radius:16px;
  padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}

#map{height:400px;width:100%;border-radius:14px;}

.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.back{
  padding:8px 14px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

  <div class="top">
    <h3>üåç Live GPS Path</h3>
    <button class="back" onclick="location.href='index.html'">‚¨Ö Back</button>
  </div>

  <div class="card">
    <div id="map"></div>
  </div>

</div>

<script>

let map, marker, polyline;
let path=[];

function initMap(){
  const start={lat:12.9716,lng:77.5946};

  map=new google.maps.Map(document.getElementById("map"),{
    zoom:16,center:start
  });

  marker=new google.maps.Marker({position:start,map});
  polyline=new google.maps.Polyline({
    path:path,
    map:map,
    strokeColor:"#00ff88",
    strokeWeight:4
  });
}

initMap();

const options = {
  username: "agribot",
  password: "Agribot123"
};

const client = mqtt.connect("wss://93482c172cb3465898cde100a0b26b0d.s1.eu.hivemq.cloud:8884/mqtt", options);

client.on("connect", function () {
  client.subscribe("agriBot/gps");
});

client.on("message", function (topic, message) {

  let data = JSON.parse(message.toString());

  if(topic === "agriBot/gps"){
      const p={lat:data.lat,lng:data.lng};
      path.push(p);
      polyline.setPath(path);
      marker.setPosition(p);
      map.panTo(p);
  }
});

</script>
</body>
</html>